#+TITLE: Emacs Theme and Fonts
#+STARTUP: overview indent

  
* Geometry

  #+begin_src emacs-lisp
    (require 'saveplace)
    (setq-default save-place t)
  #+end_src

  Save emacs frames on exit, and restore them on startup
  #+begin_src emacs-lisp
    ;; These are the same values that a bare-naked emacs uses on initial startup
    (defvar my-initial-geometry '(nil 80 38 100 100)
      "The initial frame geometry to use when no geometry file is present.")

    (defvar my-geometry-file
      (expand-file-name ".geometry" user-emacs-directory)
      "The file where frame geometry settings are saved.")

    (defun my-load-frame-geometry ()
      "Load saved frame geometry settings."
      (if (file-readable-p my-geometry-file)
          (with-temp-buffer
            (insert-file-contents my-geometry-file)
            (read (buffer-string)))
        my-initial-geometry))

    (defun my-get-geometry ()
      "Get the current geometry of the active frame."
      (mapcar
       (apply-partially 'frame-parameter nil)
       (list 'fullscreen 'width 'height 'top 'left)))

    (defun my-save-frame-geometry ()
      "Save current frame geometry settings."
      (with-temp-file my-geometry-file
        (print (my-get-geometry) (current-buffer))))

    (defun my-set-geometry ()
      "Set the default frame geometry using the values loaded from my-geometry-file."
      (let ((geom (my-load-frame-geometry)))
        (setq default-frame-alist
              (append
               default-frame-alist
               `((fullscreen . ,(nth 0 geom))
                 (width . ,(nth 1 geom))
                 (height . ,(nth 2 geom))
                 (top . ,(nth 3 geom))
                 (left . ,(nth 4 geom)))))))

    ;; Returns (top left bottom right) measured in pixels
    (defun my-get-geometry-pixels ()
      "Get the current geometry, measured in pixels, of the active frame."
      (let ((width (frame-pixel-width))
            (height (frame-pixel-height))
            (top (eval (frame-parameter nil 'top)))
            (left (eval (frame-parameter nil 'left))))
        (list top left (+ top width) (+ left height))))

    (defun my-get-margins-pixels ()
      "Return the margins remaining on each side of the frame, measured in pixels."
      (let ((frame-size (my-get-geometry-pixels))
            (display-size (cdr (assq 'workarea (frame-monitor-attributes)))))
        (list
         (- (nth 0 frame-size) (nth 0 display-size))      ; left side of the frame
         (- (nth 1 frame-size) (nth 1 display-size))      ; top side of the frame
         (- (nth 2 display-size) (nth 2 frame-size))      ; right side of the frame
         (- (nth 3 display-size) (nth 3 frame-size)))))   ; bottom side of the frame

    (defun my-geometry-startup-after-init (&optional frame)
      "Called after loading the init file."
      (if (display-graphic-p)
          (with-selected-frame (or frame (selected-frame))
            (my-set-geometry)
            (add-hook 'kill-emacs-hook 'my-save-frame-geometry))))
            ;; (add-to-list 'default-frame-alist '(internal-border-width . 0))
            ;; (set-fringe-mode '(8 . 0)))
        ;; Menu bar always off in text mode
        ;; (menu-bar-mode -1))))

    (add-hook 'after-init-hook 'my-geometry-startup-after-init)
    (add-hook 'before-make-frame-hook 'my-set-geometry)
  #+end_src
  
* Theme

  The default font is set in the site-specific preload file.
  #+begin_src emacs-lisp
    (unless (boundp 'my-default-font)
      (defvar my-default-font "Fira Code-14"))
  #+end_src
    
  Specify the default font.
  #+begin_src emacs-lisp
    (add-to-list 'default-frame-alist `(font . ,my-default-font))
    (set-face-font 'default my-default-font)
  #+end_src
  
  Truncate long lines everywhere.
  #+begin_src emacs-lisp
    (global-visual-line-mode 0)
    (setq-default truncate-lines t)
  #+end_src
    
  Highlight current line.
  #+begin_src emacs-lisp
    (global-hl-line-mode t)
  #+end_src

  #+begin_src emacs-lisp
    (use-package vscode-dark-plus-theme
      :ensure t
      :config
      (load-theme 'vscode-dark-plus t)
      (setq face-remapping-alist
            `((show-paren-match
               . (:weight bold
                  :foreground "#ecbc9c"))
              (show-paren-mismatch
               . (:strike-through t
                  :foreground "#cc6666"))
              (sp-show-pair-match-face
               . (:weight bold
                  :foreground "#ecbc9c"))
              (sp-show-pair-mismatch-face
               . (:strike-through t
                  :foreground "#cc6666"))
              (font-lock-function-name-face
               . (:foreground "#4ec9b0"
                  :weight normal))
              (font-lock-keyword-face
               . (:foreground "cornflower blue"
                  :weight normal))
              (font-lock-variable-name-face
               . (:foreground "#f0c674"))
              (lsp-face-highlight-read
               . (:underline t
                  :background nil
                  :foreground nil))
              (lsp-face-highlight-textual
               . (:underline t
                  :background nil
                  :foreground nil))
              (lsp-face-highlight-write
               . (:underline t
                  :background nil
                  :foreground nil))
              (lsp-ui-peek-highlight
               . (:inherit nil
                  :background nil
                  :foreground nil
                  :weight semi-bold
                  :box (:line-width -1)))
              (org-block
               . (:extend t
                  :background "gray12"
                  :foreground "#e8e8e8"))
              (org-block-begin-line
               . (:extend t
                  :background "gray12"
                  :foreground "gray40"))
              (org-tree-slide-heading-level-1
               . (:height 1.8
                  :weight bold))
              (org-tree-slide-heading-level-2
               . (:height 1.5
                  :weight bold))
              (org-tree-slide-heading-level-3
               . (:height 1.5
                  :weight bold))
              (org-tree-slide-heading-level-4
               . (:height 1.5
                  :weight bold)))))
  #+end_src
    
  #+begin_src emacs-lisp
    ;; (use-package base16-theme
    ;;   :disabled
    ;;   :ensure t
    ;;   :config
    ;;   (load-theme 'base16-tomorrow-night t)
    ;;   (let ((base00 (plist-get base16-tomorrow-night-theme-colors :base00))
    ;;         (base01 (plist-get base16-tomorrow-night-theme-colors :base01))
    ;;         (base02 (plist-get base16-tomorrow-night-theme-colors :base02))
    ;;         (base03 (plist-get base16-tomorrow-night-theme-colors :base03))
    ;;         (base04 (plist-get base16-tomorrow-night-theme-colors :base04))
    ;;         (base05 (plist-get base16-tomorrow-night-theme-colors :base05))
    ;;         (base06 (plist-get base16-tomorrow-night-theme-colors :base06))
    ;;         (base07 (plist-get base16-tomorrow-night-theme-colors :base07))
    ;;         (base08 (plist-get base16-tomorrow-night-theme-colors :base08))
    ;;         (base09 (plist-get base16-tomorrow-night-theme-colors :base09))
    ;;         (base0A (plist-get base16-tomorrow-night-theme-colors :base0A))
    ;;         (base0B (plist-get base16-tomorrow-night-theme-colors :base0B))
    ;;         (base0C (plist-get base16-tomorrow-night-theme-colors :base0C))
    ;;         (base0D (plist-get base16-tomorrow-night-theme-colors :base0D))
    ;;         (base0E (plist-get base16-tomorrow-night-theme-colors :base0E))
    ;;         (base0F (plist-get base16-tomorrow-night-theme-colors :base0F)))
    ;;     (setq face-remapping-alist
    ;;           `((show-paren-match
    ;;              . (:foreground ,base0D
    ;;                 :background ,base01))
    ;;             (show-paren-mismatch
    ;;              . (:strike-through t
    ;;                 :foreground ,base09
    ;;                 :background ,base01))
    ;;             (sp-show-pair-match-face
    ;;              . (:foreground ,base0D
    ;;                 :background ,base01))
    ;;             (sp-show-pair-mismatch-face
    ;;              . (:strike-through t
    ;;                 :foreground ,base09
    ;;                 :background ,base01))
    ;;             (font-lock-keyword-face
    ;;              . (:foreground ,base0E))
    ;;             (font-lock-builtin-face
    ;;              . (:foreground ,base0C))
    ;;             (font-lock-function-name-face
    ;;              . (:foreground "cornflower blue"))
    ;;             (font-lock-doc-face
    ;;              . (:foreground ,base0C))
    ;;             (font-lock-string-face
    ;;              . (:foreground "slate gray"))
    ;;             (font-lock-comment-face
    ;;              . (:foreground "light slate gray"))
    ;;             (font-lock-comment-delimiter-face
    ;;              . (:foreground "light slate gray"))
    ;;             (py-builtins-face
    ;;              . (:foreground "#ECBC9C"))
    ;;             (org-block
    ;;              . (:foreground "#ECBC9C"))
    ;;             (fringe
    ;;              . (:background unspecified))
    ;;             (avy-lead-face
    ;;              . (:foreground "#FFD700"
    ;;                 :background unspecified
    ;;                 :weight bold))
    ;;             (avy-lead-face-0
    ;;              . (:foreground "#FFD700"
    ;;                 :background unspecified
    ;;                 :weight bold))
    ;;             (avy-lead-face-2
    ;;              . (:foreground "#FFD700"
    ;;                 :background unspecified
    ;;                 :weight bold))
    ;;             ))))
  #+end_src

** Modus theme setup

#+begin_src emacs-lisp
  ;; Modus-themes are just excellent, easy to read and work really well
  ;; with code as well as text (org-mode, markdown).
  (use-package modus-themes
    :disabled
    :ensure nil
    :config
      (setq modus-themes-org-blocks 'gray-background
            modus-themes-fringes 'subtle
            modus-themes-italic-constructs t
            modus-themes-bold-constructs t
            modus-themes-syntax '(alt-syntax)
            modus-themes-hl-line '(intense)
            modus-themes-paren-match '(intense)
            modus-themes-mode-line '(borderless))
      (setq modus-themes-headings
            (quote ((1 . (background overline variable-pitch 1.4))
                    (2 . (overline rainbow variable-pitch 1.25))
                    (3 . (overline 1.1))
                    (t . (monochrome))))))

  ;; Running modus-themes depending on the time of the day.  <ATTENTION>
  ;; You need to set the longitude and latitude to your city's for this
  ;; to be accurate.
  (use-package solar
    :disabled
    :ensure nil
    :custom
    ;; Brussels ;)
    (calendar-latitude 50.85)
    (calendar-longitude 4.35))

  (use-package circadian
    :disabled
    :ensure t
    :after solar
    :config
    (setq circadian-themes '((:sunrise . modus-operandi)
                             (:sunset  . modus-vivendi)))
    (circadian-setup))
#+end_src

* Fira Code mode

   See instructions [[https://github.com/tonsky/FiraCode/wiki/Emacs-instructions][here]]. The Fira Code Symbol font must be installed
   as well as the Fira Code font. The Fira Code Symbol font can be
   installed from AUR [[https://aur.archlinux.org/packages/otf-fira-code-symbol/][here]]. The Fira Code font itself is in the pacman
   community library.

   #+begin_src emacs-lisp

     (defun fira-code-mode--make-alist (list)
       "Generate prettify-symbols alist from LIST."
       (let ((idx -1))
         (mapcar
          (lambda (s)
            (setq idx (1+ idx))
            (let* ((code (+ #Xe100 idx))
               (width (string-width s))
               (prefix ())
               (suffix '(?\s (Br . Br)))
               (n 1))
          (while (< n width)
            (setq prefix (append prefix '(?\s (Br . Bl))))
            (setq n (1+ n)))
          (cons s (append prefix suffix (list (decode-char 'ucs code))))))
          list)))

     (defconst fira-code-mode--ligatures
       '("www" "**" "***" "**/" "*>" "*/" "\\\\" "\\\\\\"
         "{-" "[]" "::" ":::" ":=" "!!" "!=" "!==" "-}"
         "--" "---" "-->" "->" "->>" "-<" "-<<" "-~"
         "#{" "#[" "##" "###" "####" "#(" "#?" "#_" "#_("
         ".-" ".=" ".." "..<" "..." "?=" "??" ";;" "/*"
         "/**" "/=" "/==" "/>" "//" "///" "&&" "||" "||="
         "|=" "|>" "^=" "$>" "++" "+++" "+>" "=:=" "=="
         "===" "==>" "=>" "=>>" "<=" "=<<" "=/=" ">-" ">="
         ">=>" ">>" ">>-" ">>=" ">>>" "<*" "<*>" "<|" "<|>"
         "<$" "<$>" "<!--" "<-" "<--" "<->" "<+" "<+>" "<="
         "<==" "<=>" "<=<" "<>" "<<" "<<-" "<<=" "<<<" "<~"
         "<~~" "</" "</>" "~@" "~-" "~=" "~>" "~~" "~~>" "%%"
         "x" ":" "+" "+" "*"))

     (defvar fira-code-mode--old-prettify-alist)

     (defun fira-code-mode--enable ()
       "Enable Fira Code ligatures in current buffer."
       (setq-local fira-code-mode--old-prettify-alist prettify-symbols-alist)
       (setq-local prettify-symbols-alist (append (fira-code-mode--make-alist fira-code-mode--ligatures) fira-code-mode--old-prettify-alist))
       (prettify-symbols-mode t))

     (defun fira-code-mode--disable ()
       "Disable Fira Code ligatures in current buffer."
       (setq-local prettify-symbols-alist fira-code-mode--old-prettify-alist)
       (prettify-symbols-mode -1))

     (define-minor-mode fira-code-mode
       "Fira Code ligatures minor mode"
       :lighter " Fira Code"
       (setq-local prettify-symbols-unprettify-at-point 'right-edge)
       (if fira-code-mode
           (fira-code-mode--enable)
         (fira-code-mode--disable)))

     (defun fira-code-mode--setup ()
       "Setup Fira Code Symbols"
       (set-fontset-font t '(#Xe100 . #Xe16f) "Fira Code Symbol"))

     (provide 'fira-code-mode)
   #+end_src
   
